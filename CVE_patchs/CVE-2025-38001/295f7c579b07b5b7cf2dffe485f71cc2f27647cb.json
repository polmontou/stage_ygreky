"diff --git a/net/sched/sch_hfsc.c b/net/sched/sch_hfsc.c\nindex 1bf4fd698c41..afcb83d469ff 100644\n--- a/net/sched/sch_hfsc.c\n+++ b/net/sched/sch_hfsc.c\n@@ -175,6 +175,11 @@ struct hfsc_sched {\n \n #define\tHT_INFINITY\t0xffffffffffffffffULL\t/* infinite time value */\n \n+static bool cl_in_el_or_vttree(struct hfsc_class *cl)\n+{\n+\treturn ((cl->cl_flags & HFSC_FSC) && cl->cl_nactive) ||\n+\t\t((cl->cl_flags & HFSC_RSC) && !RB_EMPTY_NODE(&cl->el_node));\n+}\n \n /*\n  * eligible tree holds backlogged classes being sorted by their eligible times.\n@@ -1040,6 +1045,8 @@ hfsc_change_class(struct Qdisc *sch, u32 classid, u32 parentid,\n \tif (cl == NULL)\n \t\treturn -ENOBUFS;\n \n+\tRB_CLEAR_NODE(&cl->el_node);\n+\n \terr = tcf_block_get(&cl->block, &cl->filter_list, sch, extack);\n \tif (err) {\n \t\tkfree(cl);\n@@ -1573,7 +1580,7 @@ hfsc_enqueue(struct sk_buff *skb, struct Qdisc *sch, struct sk_buff **to_free)\n \tsch->qstats.backlog += len;\n \tsch->q.qlen++;\n \n-\tif (first && !cl->cl_nactive) {\n+\tif (first && !cl_in_el_or_vttree(cl)) {\n \t\tif (cl->cl_flags & HFSC_RSC)\n \t\t\tinit_ed(cl, len);\n \t\tif (cl->cl_flags & HFSC_FSC)"