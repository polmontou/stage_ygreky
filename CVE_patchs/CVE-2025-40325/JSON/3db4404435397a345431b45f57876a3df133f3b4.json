"diff --git a/drivers/md/raid10.c b/drivers/md/raid10.c\nindex 1c2026682f86..9d8516acf2fd 100644\n--- a/drivers/md/raid10.c\n+++ b/drivers/md/raid10.c\n@@ -1624,11 +1624,10 @@ static int raid10_handle_discard(struct mddev *mddev, struct bio *bio)\n \tif (test_bit(MD_RECOVERY_RESHAPE, &mddev->recovery))\n \t\treturn -EAGAIN;\n \n-\tif (WARN_ON_ONCE(bio->bi_opf & REQ_NOWAIT)) {\n+\tif (!wait_barrier(conf, bio->bi_opf & REQ_NOWAIT)) {\n \t\tbio_wouldblock_error(bio);\n \t\treturn 0;\n \t}\n-\twait_barrier(conf, false);\n \n \t/*\n \t * Check reshape again to avoid reshape happens after checking"