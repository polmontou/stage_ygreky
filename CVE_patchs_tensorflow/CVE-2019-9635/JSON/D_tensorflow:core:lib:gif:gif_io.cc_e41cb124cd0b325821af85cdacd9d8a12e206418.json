"diff --git a/tensorflow/core/lib/gif/gif_io.cc b/tensorflow/core/lib/gif/gif_io.cc\nindex ce842e97230..dc5406920a4 100644\n--- a/tensorflow/core/lib/gif/gif_io.cc\n+++ b/tensorflow/core/lib/gif/gif_io.cc\n@@ -140,6 +140,10 @@ uint8* Decode(const void* srcdata, int datasize,\n     ColorMapObject* color_map = this_image->ImageDesc.ColorMap\n                                     ? this_image->ImageDesc.ColorMap\n                                     : gif_file->SColorMap;\n+    if (color_map == nullptr) {\n+      *error_string = strings::StrCat(\"missing color map for frame \", k);\n+      return nullptr;\n+    }\n \n     for (int i = imgTop; i < imgBottom; ++i) {\n       uint8* p_dst = this_dst + i * width * channel;"