"diff --git a/tensorflow/lite/kernels/kernel_util.cc b/tensorflow/lite/kernels/kernel_util.cc\nindex 27d9da84c0a..fab884bc90c 100644\n--- a/tensorflow/lite/kernels/kernel_util.cc\n+++ b/tensorflow/lite/kernels/kernel_util.cc\n@@ -32,11 +32,17 @@ namespace {\n \n inline TfLiteTensor* GetMutableInput(const TfLiteContext* context,\n                                      const TfLiteNode* node, int index) {\n-  if (context->tensors != nullptr) {\n-    return &context->tensors[node->inputs->data[index]];\n-  } else {\n-    return context->GetTensor(context, node->inputs->data[index]);\n+  if (index >= 0 && index < node->inputs->size) {\n+    const int tensor_index = node->inputs->data[index];\n+    if (tensor_index != kTfLiteOptionalTensor) {\n+      if (context->tensors != nullptr) {\n+        return &context->tensors[tensor_index];\n+      } else {\n+        return context->GetTensor(context, tensor_index);\n+      }\n+    }\n   }\n+  return nullptr;\n }\n \n }  // anonymous namespace.\n@@ -54,11 +60,17 @@ TfLiteTensor* GetVariableInput(TfLiteContext* context, const TfLiteNode* node,\n \n TfLiteTensor* GetOutput(TfLiteContext* context, const TfLiteNode* node,\n                         int index) {\n-  if (context->tensors != nullptr) {\n-    return &context->tensors[node->outputs->data[index]];\n-  } else {\n-    return context->GetTensor(context, node->outputs->data[index]);\n+  if (index >= 0 && index < node->outputs->size) {\n+    const int tensor_index = node->outputs->data[index];\n+    if (tensor_index != kTfLiteOptionalTensor) {\n+      if (context->tensors != nullptr) {\n+        return &context->tensors[tensor_index];\n+      } else {\n+        return context->GetTensor(context, tensor_index);\n+      }\n+    }\n   }\n+  return nullptr;\n }\n \n const TfLiteTensor* GetOptionalInputTensor(const TfLiteContext* context,"