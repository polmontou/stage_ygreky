"diff --git a/tensorflow/core/kernels/immutable_constant_op.cc b/tensorflow/core/kernels/immutable_constant_op.cc\nindex 1cfbdb82778..19aa865c1fb 100644\n--- a/tensorflow/core/kernels/immutable_constant_op.cc\n+++ b/tensorflow/core/kernels/immutable_constant_op.cc\n@@ -17,6 +17,8 @@ limitations under the License.\n \n #include <unordered_set>\n \n+#include \"tensorflow/core/framework/types.pb.h\"\n+\n namespace tensorflow {\n \n namespace {\n@@ -86,6 +88,9 @@ ImmutableConstantOp::ImmutableConstantOp(OpKernelConstruction* context)\n   OP_REQUIRES_OK(context,\n                  context->GetAttr(kMemoryRegionNameAttr, &region_name_));\n   OP_REQUIRES_OK(context, context->GetAttr(kDTypeAttr, &dtype_));\n+  OP_REQUIRES(context, dtype_ != DT_RESOURCE && dtype_ != DT_VARIANT,\n+              errors::InvalidArgument(\n+                  \"Resource and variant dtypes are invalid for this op.\"));\n   OP_REQUIRES_OK(context, context->GetAttr(kShapeAttr, &shape_));\n }\n "