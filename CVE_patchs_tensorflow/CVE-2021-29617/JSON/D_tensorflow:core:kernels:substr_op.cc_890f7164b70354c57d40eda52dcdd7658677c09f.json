"diff --git a/tensorflow/core/kernels/substr_op.cc b/tensorflow/core/kernels/substr_op.cc\nindex e382381e122..ab83efda2a2 100644\n--- a/tensorflow/core/kernels/substr_op.cc\n+++ b/tensorflow/core/kernels/substr_op.cc\n@@ -51,6 +51,11 @@ class SubstrOp : public OpKernel {\n     const Tensor& len_tensor = context->input(2);\n     const TensorShape& input_shape = input_tensor.shape();\n     const TensorShape& pos_shape = pos_tensor.shape();\n+    const TensorShape& len_shape = len_tensor.shape();\n+    OP_REQUIRES(context, (pos_shape == len_shape),\n+                errors::InvalidArgument(\n+                    \"pos and len should have the same shape, got: \",\n+                    pos_shape.DebugString(), \" vs. \", len_shape.DebugString()));\n \n     bool is_scalar = TensorShapeUtils::IsScalar(pos_shape);\n "