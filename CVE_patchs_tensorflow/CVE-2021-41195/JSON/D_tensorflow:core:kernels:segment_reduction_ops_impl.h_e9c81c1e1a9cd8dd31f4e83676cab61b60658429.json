"diff --git a/tensorflow/core/kernels/segment_reduction_ops_impl.h b/tensorflow/core/kernels/segment_reduction_ops_impl.h\nindex e257321fdc6..a44ede6dbe5 100644\n--- a/tensorflow/core/kernels/segment_reduction_ops_impl.h\n+++ b/tensorflow/core/kernels/segment_reduction_ops_impl.h\n@@ -110,7 +110,9 @@ class SegmentReductionOp : public OpKernel {\n                 errors::InvalidArgument(\"Shape must be at least rank 1\"));\n \n     TensorShape output_shape = input.shape();\n-    output_shape.set_dim(0, output_rows);\n+    // Since we're changing the first dimension of the shape, we need to make\n+    // sure the new shape won't overflow.\n+    OP_REQUIRES_OK(context, output_shape.SetDimWithStatus(0, output_rows));\n \n     // Note that we do not initialize the output buffer with a default value, so\n     // we need to explicitly set missing indices to the default value.\n@@ -290,7 +292,10 @@ class SegmentReductionGPUOp : public AsyncOpKernel {\n                         done);\n \n       TensorShape output_shape = input.shape();\n-      output_shape.set_dim(0, output_rows);\n+      // Since we're changing the first dimension of the shape, we need to make\n+      // sure the new shape won't overflow.\n+      OP_REQUIRES_OK_ASYNC(context,\n+                           output_shape.SetDimWithStatus(0, output_rows), done);\n \n       Tensor* output = nullptr;\n       OP_REQUIRES_OK_ASYNC("