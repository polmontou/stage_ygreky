"diff --git a/tensorflow/core/grappler/optimizers/constant_folding.cc b/tensorflow/core/grappler/optimizers/constant_folding.cc\nindex a05823f71d0..77a3f22efd4 100644\n--- a/tensorflow/core/grappler/optimizers/constant_folding.cc\n+++ b/tensorflow/core/grappler/optimizers/constant_folding.cc\n@@ -1017,7 +1017,12 @@ bool ConstantFolding::IsFoldableUncached(\n       }\n     }\n     for (const auto& output_prop : output_props) {\n-      const PartialTensorShape output_shape(output_prop.shape());\n+      PartialTensorShape output_shape;\n+      if (!PartialTensorShape::BuildPartialTensorShape(output_prop.shape(),\n+                                                       &output_shape)\n+               .ok()) {\n+        return false;\n+      }\n       if (output_shape.IsFullyDefined()) {\n         const int64_t num_bytes =\n             output_shape.num_elements() * DataTypeSize(output_prop.dtype());"