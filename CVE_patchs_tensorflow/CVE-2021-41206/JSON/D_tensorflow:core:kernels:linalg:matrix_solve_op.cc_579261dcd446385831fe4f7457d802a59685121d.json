"diff --git a/tensorflow/core/kernels/linalg/matrix_solve_op.cc b/tensorflow/core/kernels/linalg/matrix_solve_op.cc\nindex 70f02bddf9b..aeb0203b4a3 100644\n--- a/tensorflow/core/kernels/linalg/matrix_solve_op.cc\n+++ b/tensorflow/core/kernels/linalg/matrix_solve_op.cc\n@@ -143,15 +143,22 @@ class MatrixSolveOpGpu : public AsyncOpKernel {\n                       done);\n     OP_REQUIRES_ASYNC(\n         context, input.dim_size(ndims - 2) == n,\n-        errors::InvalidArgument(\"Input matrices must be squares, got\",\n+        errors::InvalidArgument(\"Input matrices must be squares, got \",\n                                 input.dim_size(ndims - 2), \" != \", n),\n         done);\n     OP_REQUIRES_ASYNC(context, rhs.dim_size(ndims - 2) == n,\n                       errors::InvalidArgument(\n                           \"Input matrix and right-hand side must have the \"\n-                          \"same number of rows, got\",\n+                          \"same number of rows, got \",\n                           n, \" != \", rhs.dim_size(ndims - 2)),\n                       done);\n+    for (int dim = 0; dim < ndims - 2; dim++) {\n+      OP_REQUIRES_ASYNC(\n+          context, input.dim_size(dim) == rhs.dim_size(dim),\n+          errors::InvalidArgument(\n+              \"All input tensors must have the same outer dimensions.\"),\n+          done);\n+    }\n \n     // Allocate output.\n     Tensor* output;"