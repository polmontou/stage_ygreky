"diff --git a/tensorflow/core/kernels/pooling_ops_3d.cc b/tensorflow/core/kernels/pooling_ops_3d.cc\nindex d4dc87c7e3f..d4444b677a9 100644\n--- a/tensorflow/core/kernels/pooling_ops_3d.cc\n+++ b/tensorflow/core/kernels/pooling_ops_3d.cc\n@@ -366,6 +366,19 @@ class MaxPooling3dGradOp : public OpKernel {\n \n     OP_REQUIRES_OK(context, Get3dOutputSize(input_size, window, stride,\n                                             padding_, &out, &padding));\n+\n+    const int64_t depth = GetTensorDim(tensor_in, data_format_, 'C');\n+    const int64_t in_batch = GetTensorDim(tensor_in, data_format_, 'N');\n+    TensorShape out_shape = ShapeFromFormat(data_format_, in_batch,\n+                                            {{out[2], out[1], out[0]}}, depth);\n+    OP_REQUIRES(\n+        context, tensor_out.shape() == out_shape,\n+        errors::InvalidArgument(\"Expected orig_output shape to be \", out_shape,\n+                                \", but got \", tensor_out.shape()));\n+    OP_REQUIRES(context, out_backprop.shape() == out_shape,\n+                errors::InvalidArgument(\"Expected grad shape to be \", out_shape,\n+                                        \", but got \", out_backprop.shape()));\n+\n     LaunchMaxPooling3dGradOp<Device, T>::launch(\n         context, tensor_in, tensor_out, out_backprop, window, stride, out,\n         padding, data_format_, input_backprop);\n@@ -712,6 +725,14 @@ class MaxPooling3dGradGradOp : public OpKernel {\n     Pool3dParameters params{context,  ksize_,       stride_,\n                             padding_, data_format_, tensor_in.shape()};\n     if (!context->status().ok()) return;  // params is invalid\n+    OP_REQUIRES(context, tensor_out.shape() == params.forward_output_shape(),\n+                errors::InvalidArgument(\"Expected orig_output shape to be \",\n+                                        params.forward_output_shape(),\n+                                        \", but got \", tensor_out.shape()));\n+    OP_REQUIRES(\n+        context, out_grad_backprop.shape() == tensor_in.shape(),\n+        errors::InvalidArgument(\"Expected grad shape to be \", tensor_in.shape(),\n+                                \", but got \", out_grad_backprop.shape()));\n \n     Tensor* output = nullptr;\n     OP_REQUIRES_OK(context, context->forward_input_or_allocate_output("