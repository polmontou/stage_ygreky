"diff --git a/tensorflow/core/kernels/set_kernels.cc b/tensorflow/core/kernels/set_kernels.cc\nindex 5c6170f9188..3570e6229f6 100644\n--- a/tensorflow/core/kernels/set_kernels.cc\n+++ b/tensorflow/core/kernels/set_kernels.cc\n@@ -70,8 +70,12 @@ Status SparseTensorFromContext(OpKernelContext* ctx, const int32_t base_index,\n                                sparse::SparseTensor* tensor) {\n   // Assume row-major order.\n   TensorShape shape;\n-  TF_RETURN_IF_ERROR(TensorShape::BuildTensorShape(\n-      ctx->input(base_index + 2).vec<int64_t>(), &shape));\n+  const Tensor& shape_tensor = ctx->input(base_index + 2);\n+  if (shape_tensor.dims() != 1) {\n+    return errors::InvalidArgument(\"Shape must be a 1D tensor.\");\n+  }\n+  TF_RETURN_IF_ERROR(\n+      TensorShape::BuildTensorShape(shape_tensor.vec<int64_t>(), &shape));\n   CheckRankAtLeast2(ctx, shape);\n   std::vector<int64_t> order(shape.dims());\n   std::iota(order.begin(), order.end(), 0);"