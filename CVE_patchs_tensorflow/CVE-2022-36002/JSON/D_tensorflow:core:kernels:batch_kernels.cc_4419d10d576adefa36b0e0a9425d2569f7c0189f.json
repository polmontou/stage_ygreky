"diff --git a/tensorflow/core/kernels/batch_kernels.cc b/tensorflow/core/kernels/batch_kernels.cc\nindex 7aba9db55dd..df84bb9d5e6 100644\n--- a/tensorflow/core/kernels/batch_kernels.cc\n+++ b/tensorflow/core/kernels/batch_kernels.cc\n@@ -23,6 +23,7 @@ limitations under the License.\n #include \"tensorflow/core/framework/op_requires.h\"\n #include \"tensorflow/core/framework/resource_mgr.h\"\n #include \"tensorflow/core/framework/tensor.h\"\n+#include \"tensorflow/core/framework/tensor_shape.h\"\n #include \"tensorflow/core/framework/tensor_util.h\"\n #include \"tensorflow/core/framework/types.h\"\n #include \"tensorflow/core/kernels/batching_util/adaptive_shared_batch_scheduler.h\"\n@@ -654,6 +655,12 @@ class UnbatchResource : public ResourceBase {\n           batch_index_t.shape().dim_size(1), \".\");\n     }\n \n+    if (!TensorShapeUtils::IsScalar(context->input(2).shape())) {\n+      return errors::InvalidArgument(\n+          \"Input id should be scalar; \"\n+          \"Got: \",\n+          context->input(2).DebugString(), \".\");\n+    }\n     const int64_t batch_key = context->input(2).scalar<int64_t>()();\n     const bool nonempty_input = batch_index_t.dim_size(0) > 0;\n "