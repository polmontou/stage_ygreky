"diff --git a/tensorflow/core/kernels/sdca_ops.cc b/tensorflow/core/kernels/sdca_ops.cc\nindex 98b4fd1c82b..d279eda86e7 100644\n--- a/tensorflow/core/kernels/sdca_ops.cc\n+++ b/tensorflow/core/kernels/sdca_ops.cc\n@@ -49,6 +49,7 @@ limitations under the License.\n #include \"tensorflow/core/lib/core/status.h\"\n #include \"tensorflow/core/lib/core/stringpiece.h\"\n #include \"tensorflow/core/lib/gtl/inlined_vector.h\"\n+#include \"tensorflow/core/platform/errors.h\"\n #include \"tensorflow/core/platform/fingerprint.h\"\n #include \"tensorflow/core/platform/macros.h\"\n #include \"tensorflow/core/platform/mutex.h\"\n@@ -142,6 +143,10 @@ void DoCompute(const ComputeOptions& options, OpKernelContext* const context) {\n   const Tensor* example_state_data_t;\n   OP_REQUIRES_OK(context,\n                  context->input(\"example_state_data\", &example_state_data_t));\n+  OP_REQUIRES(\n+      context, TensorShapeUtils::IsMatrix(example_state_data_t->shape()),\n+      errors::InvalidArgument(\"example_state_data must be rank 2 but is rank \",\n+                              example_state_data_t->dims()));\n   TensorShape expected_example_state_shape({examples.num_examples(), 4});\n   OP_REQUIRES(context,\n               example_state_data_t->shape() == expected_example_state_shape,"