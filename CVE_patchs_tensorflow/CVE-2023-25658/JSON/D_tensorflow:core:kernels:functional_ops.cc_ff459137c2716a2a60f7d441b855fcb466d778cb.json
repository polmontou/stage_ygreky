"diff --git a/tensorflow/core/kernels/functional_ops.cc b/tensorflow/core/kernels/functional_ops.cc\nindex 5f338f12583..b20360873e2 100644\n--- a/tensorflow/core/kernels/functional_ops.cc\n+++ b/tensorflow/core/kernels/functional_ops.cc\n@@ -160,7 +160,8 @@ class IfOp : public AsyncOpKernel {\n           then_handle_(then_handle),\n           else_handle_(else_handle),\n           done_(std::move(done)),\n-          lib_(CHECK_NOTNULL(ctx_->function_library())) {\n+          lib_(CHECK_NOTNULL(ctx_->function_library())),\n+          opts_(ctx->step_id()) {\n       SetRunOptions(ctx_, &opts_, true /* always_collect_stats */);\n       for (int i = 1; i < ctx_->num_inputs(); ++i) {\n         args_.push_back(ctx_->input(i));\n@@ -286,7 +287,8 @@ class CaseOp : public AsyncOpKernel {\n           branch_(branch),\n           branch_handles_(branch_handles),\n           done_(std::move(done)),\n-          lib_(CHECK_NOTNULL(ctx_->function_library())) {\n+          lib_(CHECK_NOTNULL(ctx_->function_library())),\n+          opts_(ctx->step_id()) {\n       SetRunOptions(ctx_, &opts_, true /* always_collect_stats */);\n       for (int i = 1; i < ctx_->num_inputs(); ++i) {\n         args_.push_back(ctx_->input(i));\n@@ -507,7 +509,8 @@ class WhileOp : public AsyncOpKernel {\n           cond_handle_(cond_handle),\n           body_handle_(body_handle),\n           done_(std::move(done)),\n-          lib_(CHECK_NOTNULL(ctx_->function_library())) {\n+          lib_(CHECK_NOTNULL(ctx_->function_library())),\n+          opts_(ctx->step_id()) {\n       SetRunOptions(ctx_, &opts_, false /* always_collect_stats */);\n       GetArgsFromContext(ctx, &args_, &loop_var_types_);\n       body_frame_ =\n@@ -751,6 +754,7 @@ class ForOp : public AsyncOpKernel {\n           ctx_(ctx),\n           done_(std::move(done)),\n           lib_(CHECK_NOTNULL(ctx_->function_library())),\n+          opts_(ctx->step_id()),\n           args_(1 + ctx_->num_inputs() - 3) {\n       args_[0] = Tensor(DT_INT32, {});\n       iter_ = &args_[0].scalar<int32>()();"