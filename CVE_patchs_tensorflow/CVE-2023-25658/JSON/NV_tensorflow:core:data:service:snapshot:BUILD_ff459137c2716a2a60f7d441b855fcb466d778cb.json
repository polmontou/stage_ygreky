"# Distributed snapshot library.\n\nload(\"//tensorflow:tensorflow.bzl\", \"tf_cc_test\")\nload(\"//tensorflow:tensorflow.default.bzl\", \"tf_grpc_cc_dependencies\")\nload(\"//tensorflow/core/platform:build_config.bzl\", \"tf_protos_profiler_service\")\nload(\"//tensorflow/tsl:tsl.default.bzl\", \"get_compatible_with_portable\")\n\npackage(\n    # copybara:uncomment default_applicable_licenses = [\"//tensorflow:license\"],\n    default_visibility = [\n        \"//tensorflow:internal\",\n    ],\n    licenses = [\"notice\"],\n)\n\ntf_cc_test(\n    name = \"distributed_snapshot_test\",\n    srcs = [\"distributed_snapshot_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":path_utils\",\n        \":snapshot_reader\",\n        \"@com_google_absl//absl/strings\",\n        \"@com_google_absl//absl/time\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/data:snapshot_utils\",\n        \"//tensorflow/core/data/service:dispatcher_client\",\n        \"//tensorflow/core/data/service:test_cluster\",\n        \"//tensorflow/core/data/service:test_util\",\n        \"//tensorflow/core/framework:tensor_proto_cc\",\n        \"//tensorflow/tsl/platform:env\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:status_matchers\",\n        \"//tensorflow/tsl/platform:statusor\",\n        \"//tensorflow/tsl/platform:tstring\",\n    ] + tf_grpc_cc_dependencies() + tf_protos_profiler_service(),\n)\n\ncc_library(\n    name = \"file_utils\",\n    srcs = [\"file_utils.cc\"],\n    hdrs = [\"file_utils.h\"],\n    compatible_with = get_compatible_with_portable(),\n    deps = [\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core/data:snapshot_utils\",\n        \"//tensorflow/tsl/platform:env\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:protobuf\",\n        \"//tensorflow/tsl/platform:status\",\n        \"@com_google_absl//absl/functional:function_ref\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ntf_cc_test(\n    name = \"file_utils_test\",\n    srcs = [\"file_utils_test.cc\"],\n    deps = [\n        \":file_utils\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/data:dataset_test_base\",\n        \"//tensorflow/core/data:snapshot_utils\",\n        \"//tensorflow/core/data/service:test_util\",\n        \"//tensorflow/core/framework:types_proto_cc\",\n        \"//tensorflow/tsl/platform:env\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:path\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:statusor\",\n    ],\n)\n\ncc_library(\n    name = \"path_utils\",\n    srcs = [\"path_utils.cc\"],\n    hdrs = [\"path_utils.h\"],\n    compatible_with = get_compatible_with_portable(),\n    deps = [\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:path\",\n        \"//tensorflow/tsl/platform:statusor\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ntf_cc_test(\n    name = \"path_utils_test\",\n    srcs = [\"path_utils_test.cc\"],\n    deps = [\n        \":path_utils\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/tsl/platform:status_matchers\",\n        \"//tensorflow/tsl/protobuf:protos_all_cc\",\n    ],\n)\n\ncc_library(\n    name = \"snapshot_split_provider\",\n    srcs = [\"snapshot_split_provider.cc\"],\n    hdrs = [\"snapshot_split_provider.h\"],\n    compatible_with = get_compatible_with_portable(),\n    deps = [\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core/data/service:dispatcher_client\",\n        \"//tensorflow/core/data/service:dispatcher_proto_cc\",\n        \"//tensorflow/core/data/service:grpc_util\",\n        \"//tensorflow/tsl/platform:env\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:mutex\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:thread_annotations\",\n        \"@com_google_absl//absl/time\",\n    ],\n)\n\ncc_library(\n    name = \"snapshot_manager\",\n    srcs = [\"snapshot_manager.cc\"],\n    hdrs = [\"snapshot_manager.h\"],\n    compatible_with = get_compatible_with_portable(),\n    deps = [\n        \":file_utils\",\n        \":path_utils\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/data:snapshot_utils\",\n        \"//tensorflow/core/data/service:common_proto_cc\",\n        \"//tensorflow/core/data/service:dispatcher_proto_cc\",\n        \"//tensorflow/core/data/service:split_provider\",\n        \"//tensorflow/core/platform:status\",\n        \"//tensorflow/tsl/platform:env\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:statusor\",\n    ],\n)\n\ncc_library(\n    name = \"snapshot_reader\",\n    srcs = [\"snapshot_reader.cc\"],\n    hdrs = [\"snapshot_reader.h\"],\n    compatible_with = get_compatible_with_portable(),\n    deps = [\n        \":path_utils\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/data:snapshot_utils\",\n        \"//tensorflow/core/data/service:common\",\n        \"//tensorflow/tsl/platform:env\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:path\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:statusor\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ntf_cc_test(\n    name = \"snapshot_reader_test\",\n    size = \"small\",\n    srcs = [\"snapshot_reader_test.cc\"],\n    deps = [\n        \":path_utils\",\n        \":snapshot_reader\",\n        \":snapshot_stream_writer\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/data:standalone\",\n        \"//tensorflow/core/data/service:common\",\n        \"//tensorflow/core/data/service:common_proto_cc\",\n        \"//tensorflow/core/data/service:task_runner\",\n        \"//tensorflow/core/data/service:test_util\",\n        \"//tensorflow/core/framework:types_proto_cc\",\n        \"//tensorflow/tsl/platform:env\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:status_matchers\",\n        \"//tensorflow/tsl/platform:statusor\",\n        \"//tensorflow/tsl/protobuf:protos_all_cc\",\n    ],\n)\n\ncc_library(\n    name = \"snapshot_stream_writer\",\n    srcs = [\"snapshot_stream_writer.cc\"],\n    hdrs = [\"snapshot_stream_writer.h\"],\n    compatible_with = get_compatible_with_portable(),\n    deps = [\n        \":file_utils\",\n        \":path_utils\",\n        \":utils\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/data:snapshot_utils\",\n        \"//tensorflow/core/data/service:common_proto_cc\",\n        \"//tensorflow/core/data/service:task_runner\",\n        \"//tensorflow/core/data/service:worker_proto_cc\",\n        \"//tensorflow/tsl/platform:env\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:mutex\",\n        \"//tensorflow/tsl/platform:path\",\n        \"//tensorflow/tsl/platform:regexp\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:thread_annotations\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ntf_cc_test(\n    name = \"snapshot_stream_writer_test\",\n    size = \"small\",\n    srcs = [\"snapshot_stream_writer_test.cc\"],\n    deps = [\n        \":path_utils\",\n        \":snapshot_stream_writer\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/data:snapshot_utils\",\n        \"//tensorflow/core/data:standalone\",\n        \"//tensorflow/core/data/service:common_proto_cc\",\n        \"//tensorflow/core/data/service:task_runner\",\n        \"//tensorflow/core/data/service:test_util\",\n        \"//tensorflow/tsl/platform:env\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:path\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:status_matchers\",\n        \"//tensorflow/tsl/platform:statusor\",\n        \"//tensorflow/tsl/protobuf:protos_all_cc\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ncc_library(\n    name = \"utils\",\n    srcs = [\"utils.cc\"],\n    hdrs = [\"utils.h\"],\n    compatible_with = get_compatible_with_portable(),\n    deps = [\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:protos_all_cc\",\n    ],\n)\n\ntf_cc_test(\n    name = \"utils_test\",\n    size = \"small\",\n    srcs = [\"utils_test.cc\"],\n    deps = [\n        \":utils\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/framework:types_proto_cc\",\n        \"//tensorflow/tsl/platform:protobuf\",\n    ],\n)"