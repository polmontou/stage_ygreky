"load(\"//tensorflow/tsl/platform:rules_cc.bzl\", \"cc_library\")\nload(\"//tensorflow/tsl/platform:build_config_root.bzl\", \"if_static\")\nload(\"//tensorflow/tsl:tsl.default.bzl\", \"filegroup\")\nload(\"//tensorflow/tsl:tsl.bzl\", \"if_not_android\")\nload(\"//tensorflow/tsl/platform:build_config.bzl\", \"tsl_cc_test\")\nload(\n    \"//tensorflow/tsl/profiler/builds:build_config.bzl\",\n    \"tf_profiler_copts\",\n    \"tf_profiler_pybind_cc_library_wrapper\",\n)\n\n# copybara:uncomment package(default_applicable_licenses = [\"//tensorflow:license\"])\n\ncc_library(\n    name = \"context_types_hdrs\",\n    hdrs = [\"context_types.h\"],\n    visibility = [\"//visibility:public\"],\n)\n\ncc_library(\n    name = \"context_types\",\n    srcs = [\"context_types.cc\"],\n    hdrs = [\"context_types.h\"],\n    visibility = [\"//visibility:public\"],\n)\n\nfilegroup(\n    name = \"mobile_srcs_no_runtime\",\n    srcs = [\n        \"scoped_annotation.h\",\n        \"scoped_memory_debug_annotation.cc\",\n        \"scoped_memory_debug_annotation.h\",\n        \"traceme.h\",\n        \"traceme_encode.h\",\n    ],\n    visibility = [\"//visibility:public\"],\n)\n\nfilegroup(\n    name = \"mobile_srcs_only_runtime\",\n    srcs = [\n        \"connected_traceme.h\",\n        \"context_types.h\",\n    ],\n    visibility = [\"//visibility:public\"],\n)\n\ncc_library(\n    name = \"profiler_controller\",\n    srcs = [\"profiler_controller.cc\"],\n    hdrs = [\"profiler_controller.h\"],\n    visibility = [\n        \"//tensorflow/tsl/profiler:internal\",\n    ],\n    deps = [\n        \":profiler_interface\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:logging\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/profiler/protobuf:xplane_proto_cc\",\n    ],\n)\n\ncc_library(\n    name = \"profiler_factory\",\n    hdrs = [\"profiler_factory.h\"],\n    visibility = [\n        \"//tensorflow/tsl/profiler:internal\",\n        \"//tensorflow/tsl/profiler:xla_profiler_backends\",\n    ],\n    deps = [\n        \":profiler_interface\",\n        \"//tensorflow/tsl/profiler/protobuf:profiler_options_proto_cc\",\n    ] + if_static([\n        \":profiler_factory_impl\",\n    ]),\n)\n\ncc_library(\n    name = \"profiler_factory_impl\",\n    srcs = [\n        \"profiler_factory.cc\",\n        \"profiler_factory.h\",\n    ],\n    copts = tf_profiler_copts(),\n    visibility = [\n        \"//tensorflow/tsl/profiler:internal\",\n    ],\n    deps = [\n        \":profiler_interface\",\n        \"//tensorflow/tsl/platform:mutex\",\n        \"//tensorflow/tsl/profiler/lib:profiler_controller\",\n        \"//tensorflow/tsl/profiler/protobuf:profiler_options_proto_cc\",\n    ],\n    alwayslink = True,\n)\n\ntsl_cc_test(\n    name = \"profiler_factory_test\",\n    srcs = [\"profiler_factory_test.cc\"],\n    deps = [\n        \":profiler_factory\",\n        \":profiler_factory_impl\",\n        \":profiler_interface\",\n        \"//tensorflow/tsl/platform:macros\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:test\",\n        \"//tensorflow/tsl/platform:test_main\",\n        \"//tensorflow/tsl/profiler/protobuf:profiler_options_proto_cc\",\n        \"//tensorflow/tsl/profiler/protobuf:xplane_proto_cc\",\n        \"@com_google_absl//absl/memory\",\n    ],\n)\n\ncc_library(\n    name = \"profiler_interface\",\n    hdrs = [\"profiler_interface.h\"],\n    copts = tf_profiler_copts(),\n    visibility = [\n        \"//tensorflow/tsl:internal\",\n        \"//tensorflow/tsl/profiler:internal\",\n        \"//tensorflow/tsl/profiler:xla_profiler_backends\",\n    ],\n    deps = [\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/profiler/protobuf:xplane_proto_cc\",\n    ],\n)\n\ncc_library(\n    name = \"profiler_lock\",\n    srcs = [\"profiler_lock.cc\"],\n    hdrs = [\"profiler_lock.h\"],\n    copts = tf_profiler_copts(),\n    visibility = [\"//tensorflow/tsl/profiler:internal\"],\n    deps = [\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:macros\",\n        \"//tensorflow/tsl/platform:statusor\",\n        \"//tensorflow/tsl/util:env_var\",\n    ],\n)\n\ntsl_cc_test(\n    name = \"profiler_lock_test\",\n    srcs = [\"profiler_lock_test.cc\"],\n    deps = [\n        \":profiler_lock\",\n        \"//tensorflow/tsl/platform:test\",\n        \"//tensorflow/tsl/platform:test_main\",\n    ],\n)\n\ncc_library(\n    name = \"profiler_session\",\n    hdrs = [\"profiler_session.h\"],\n    visibility = [\"//tensorflow/tsl:internal\"],\n    deps = [\n        \"//tensorflow/tsl/profiler/protobuf:xplane_proto_cc\",\n        \"//tensorflow/tsl/profiler/protobuf:profiler_options_proto_cc\",\n        \"//tensorflow/tsl/platform:thread_annotations\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:mutex\",\n        \"//tensorflow/tsl/platform:platform\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:types\",\n    ] + if_not_android([\n        \":profiler_interface\",\n        \":profiler_lock\",\n    ]) + if_static([\n        \":profiler_session_impl\",\n    ]),\n)\n\ncc_library(\n    name = \"profiler_session_impl\",\n    srcs = [\n        \"profiler_session.cc\",\n        \"profiler_session.h\",\n    ],\n    copts = tf_profiler_copts(),\n    visibility = [\n        \"//tensorflow/python:__pkg__\",\n        \"//tensorflow/tsl/profiler:internal\",\n    ],\n    deps = [\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:mutex\",\n        \"//tensorflow/tsl/platform:logging\",\n        \"//tensorflow/tsl/platform:thread_annotations\",\n        \"//tensorflow/tsl/platform:types\",\n        \"//tensorflow/tsl/profiler/protobuf:xplane_proto_cc\",\n        \"//tensorflow/tsl/profiler/protobuf:profiler_options_proto_cc\",\n        \"@com_google_absl//absl/memory\",\n    ] + if_not_android([\n        \":profiler_collection\",\n        \":profiler_factory\",\n        \":profiler_interface\",\n        \":profiler_lock\",\n        \"//tensorflow/tsl/platform\",\n        \"//tensorflow/tsl/platform:platform_port\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/profiler/convert:post_process_single_host_xplane\",\n        \"//tensorflow/tsl/profiler/utils:time_utils\",\n    ]),\n    alwayslink = True,\n)\n\ncc_library(\n    name = \"traceme_encode\",\n    hdrs = [\"traceme_encode.h\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n        \"//tensorflow/tsl/platform:logging\",\n        \"//tensorflow/tsl/platform:macros\",\n        \"@com_google_absl//absl/base:core_headers\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ntsl_cc_test(\n    name = \"traceme_encode_test\",\n    srcs = [\"traceme_encode_test.cc\"],\n    deps = [\n        \":traceme_encode\",\n        \"//tensorflow/tsl/platform\",\n        \"//tensorflow/tsl/platform:test\",\n        \"//tensorflow/tsl/platform:test_main\",\n        \"@com_google_absl//absl/strings\",\n        \"@com_google_absl//absl/strings:str_format\",\n    ],\n)\n\ntf_profiler_pybind_cc_library_wrapper(\n    name = \"traceme_for_pybind\",\n    actual = \":traceme\",\n    visibility = [\"//tensorflow/tsl/profiler:xla_internal\"],\n)\n\ncc_library(\n    name = \"traceme\",\n    hdrs = [\"traceme.h\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n        \":traceme_encode\",\n        \"@com_google_absl//absl/strings\",\n        \"//tensorflow/tsl/platform\",\n        \"//tensorflow/tsl/platform:logging\",\n        \"//tensorflow/tsl/platform:macros\",\n        \"//tensorflow/tsl/platform:types\",\n    ] + if_not_android([\n        \"//tensorflow/tsl/profiler/backends/cpu:traceme_recorder\",\n        \"//tensorflow/tsl/profiler/utils:time_utils\",\n    ]),\n)\n\ncc_library(\n    name = \"nvtx_utils\",\n    hdrs = [\"nvtx_utils.h\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n        \"@com_google_absl//absl/strings\",\n        \"//tensorflow/tsl/platform:logging\",\n        \"//tensorflow/tsl/platform:macros\",\n        \"//tensorflow/tsl/platform:types\",\n    ] + if_not_android([\n        \"//tensorflow/tsl/profiler/backends/cpu:annotation_stack\",\n    ]),\n)\n\ncc_library(\n    name = \"scoped_annotation\",\n    hdrs = [\"scoped_annotation.h\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n        \"@com_google_absl//absl/strings\",\n        \"//tensorflow/tsl/platform:macros\",\n        \"//tensorflow/tsl/platform:types\",\n    ] + if_not_android([\n        \":nvtx_utils\",\n        \"//tensorflow/tsl/profiler/backends/cpu:annotation_stack\",\n    ]),\n)\n\ncc_library(\n    name = \"scoped_annotation_stack\",\n    hdrs = [\"scoped_annotation_stack.h\"],\n    visibility = [\n        \"//tensorflow/tsl/profiler:internal\",\n        \"//tensorflow/tsl/profiler:xla_internal\",\n    ],\n    deps = [\n        \"@com_google_absl//absl/strings\",\n    ] + if_not_android([\n        \":nvtx_utils\",\n        \"//tensorflow/tsl/profiler/backends/cpu:annotation_stack\",\n    ]),\n)\n\ntsl_cc_test(\n    name = \"scoped_annotation_test\",\n    size = \"small\",\n    srcs = [\"scoped_annotation_test.cc\"],\n    deps = [\n        \":scoped_annotation\",\n        \":scoped_annotation_stack\",\n        \"//tensorflow/tsl/platform:test\",\n        \"//tensorflow/tsl/platform:test_benchmark\",\n        \"//tensorflow/tsl/platform:test_main\",\n        \"//tensorflow/tsl/profiler/backends/cpu:annotation_stack\",\n        \"//tensorflow/tsl/profiler/backends/cpu:annotation_stack_impl\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ncc_library(\n    name = \"connected_traceme\",\n    hdrs = [\"connected_traceme.h\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n        \":context_types_hdrs\",\n        \":traceme\",\n        \":traceme_encode\",\n        \"@com_google_absl//absl/strings\",\n        \"@com_google_absl//absl/types:optional\",\n    ],\n)\n\ncc_library(\n    name = \"profiler_collection\",\n    srcs = [\"profiler_collection.cc\"],\n    hdrs = [\"profiler_collection.h\"],\n    deps = [\n        \":profiler_interface\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/profiler/protobuf:xplane_proto_cc\",\n    ],\n)\n\ncc_library(\n    name = \"scoped_memory_debug_annotation\",\n    srcs = [\"scoped_memory_debug_annotation.cc\"],\n    hdrs = [\"scoped_memory_debug_annotation.h\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n    ],\n)"