"load(\"//tensorflow/core/platform:rules_cc.bzl\", \"cc_library\")\nload(\n    \"//tensorflow:tensorflow.bzl\",\n    \"if_not_mobile\",\n    \"tf_cc_test\",\n)\nload(\n    \"//tensorflow/core/platform:build_config.bzl\",\n    \"tf_protos_all\",\n)\n\npackage(\n    # copybara:uncomment default_applicable_licenses = [\"//tensorflow:license\"],\n    default_visibility = [\n        \"//tensorflow:internal\",\n    ],\n    licenses = [\"notice\"],\n)\n\n# Export files for use on Android.\nexports_files([\n    \"captured_function.cc\",\n    \"captured_function.h\",\n    \"compression_utils.cc\",\n    \"compression_utils.h\",\n    \"dataset_utils.cc\",\n    \"dataset_utils.h\",\n    \"finalization_utils.cc\",\n    \"finalization_utils.h\",\n    \"metric_utils.cc\",\n    \"metric_utils.h\",\n    \"name_utils.cc\",\n    \"name_utils.h\",\n    \"rewrite_utils.cc\",\n    \"rewrite_utils.h\",\n    \"root_dataset.cc\",\n    \"root_dataset.h\",\n    \"serialization_utils.cc\",\n    \"serialization_utils.h\",\n    \"split_utils.cc\",\n    \"split_utils.h\",\n    \"stats_utils.cc\",\n    \"stats_utils.h\",\n    \"tfdataz_metrics.h\",\n    \"tfdataz_metrics.cc\",\n    \"unbounded_thread_pool.cc\",\n    \"unbounded_thread_pool.h\",\n    \"utils.cc\",\n    \"utils.h\",\n])\n\ncc_library(\n    name = \"captured_function\",\n    srcs = [\"captured_function.cc\"],\n    hdrs = [\"captured_function.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n        \":dataset_utils\",\n        \":stats_utils\",\n        \"@com_google_absl//absl/time\",\n        \"//tensorflow/core:core_cpu_internal\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:framework_internal\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:lib_internal\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/profiler/lib:traceme\",\n    ] + if_not_mobile([\n        \"//tensorflow/core/grappler:grappler_item\",\n        \"//tensorflow/core/grappler/optimizers:meta_optimizer\",\n    ]),\n)\n\ncc_library(\n    name = \"compression_utils\",\n    srcs = [\"compression_utils.cc\"],\n    hdrs = [\"compression_utils.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    visibility = [\"//tensorflow:internal\"],\n    deps = [\n        \"//tensorflow/core:core_cpu\",\n        \"//tensorflow/core:core_cpu_internal\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:lib_internal\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"@com_google_absl//absl/memory\",\n    ],\n)\n\ntf_cc_test(\n    name = \"compression_utils_test\",\n    srcs = [\"compression_utils_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    tags = [\n        \"requires-mem:24g\",\n    ],\n    deps = [\n        \":compression_utils\",\n        \":dataset_test_base\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib_internal\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core:testlib\",\n        \"//tensorflow/tsl/platform:status_matchers\",\n    ],\n)\n\ncc_library(\n    name = \"dataset_test_base\",\n    testonly = 1,\n    srcs = [\"dataset_test_base.cc\"],\n    hdrs = [\"dataset_test_base.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n        \":dataset_utils\",\n        \":name_utils\",\n        \":serialization_utils\",\n        \":split_utils\",\n        \"//tensorflow/core:core_cpu\",\n        \"//tensorflow/core:core_cpu_internal\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:framework_internal\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:lib_internal\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:testlib\",\n        \"//tensorflow/core/framework:tensor_testutil\",\n        \"//tensorflow/core/kernels:function_ops\",\n        \"//tensorflow/tsl/framework/fixedpoint\",\n        \"//third_party/eigen3\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ncc_library(\n    name = \"dataset_utils\",\n    srcs = [\"dataset_utils.cc\"],\n    hdrs = [\"dataset_utils.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n        \"//tensorflow/core:core_cpu_internal\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:lib_internal\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/platform:regexp\",\n        \"@com_google_absl//absl/container:flat_hash_map\",\n        \"@com_google_absl//absl/container:flat_hash_set\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ntf_cc_test(\n    name = \"dataset_utils_test\",\n    size = \"small\",\n    srcs = [\"dataset_utils_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":compression_utils\",\n        \":dataset_test_base\",\n        \":dataset_utils\",\n        \":serialization_utils\",\n        \"//tensorflow/cc:cc_ops\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/platform:str_util\",\n        \"//tensorflow/tsl/platform:status_matchers\",\n        \"//tensorflow/tsl/util:determinism_test_util\",\n        \"@com_google_absl//absl/container:flat_hash_set\",\n    ],\n)\n\ncc_library(\n    name = \"hash_utils\",\n    srcs = [\"hash_utils.cc\"],\n    hdrs = [\"hash_utils.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":dataset_utils\",\n        \"//tensorflow/core:core_cpu_internal\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:lib_internal\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/platform:regexp\",\n        \"@com_google_absl//absl/container:flat_hash_map\",\n        \"@com_google_absl//absl/container:flat_hash_set\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ntf_cc_test(\n    name = \"hash_utils_test\",\n    size = \"small\",\n    srcs = [\"hash_utils_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":hash_utils\",\n        \"//tensorflow/cc:cc_ops\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n    ],\n)\n\ncc_library(\n    name = \"metric_utils\",\n    srcs = [\"metric_utils.cc\"],\n    hdrs = [\n        \"metric_utils.h\",\n    ],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n        \":tfdataz_metrics\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core/data:utils\",\n        \"//tensorflow/core/platform:env\",\n        \"//tensorflow/core/platform:mutex\",\n        \"//tensorflow/core/platform:thread_annotations\",\n        \"@com_google_absl//absl/time\",\n    ],\n)\n\ntf_cc_test(\n    name = \"metric_utils_test\",\n    size = \"small\",\n    srcs = [\"metric_utils_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":metric_utils\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/lib/monitoring:cell_reader\",\n        \"//tensorflow/core/lib/monitoring:test_utils\",\n        \"//tensorflow/core/platform:env\",\n        \"@com_google_absl//absl/memory\",\n        \"@com_google_absl//absl/time\",\n    ],\n)\n\ncc_library(\n    name = \"tfdataz_metrics\",\n    srcs = [\"tfdataz_metrics.cc\"],\n    hdrs = [\"tfdataz_metrics.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core/platform:env\",\n        \"//tensorflow/core/platform:mutex\",\n        \"//tensorflow/core/platform:thread_annotations\",\n        \"@com_google_absl//absl/container:flat_hash_set\",\n        \"@com_google_absl//absl/time\",\n    ],\n)\n\ntf_cc_test(\n    name = \"tfdataz_metrics_test\",\n    size = \"small\",\n    srcs = [\"tfdataz_metrics_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":tfdataz_metrics\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/platform:env\",\n        \"//tensorflow/core/util:fake_clock_env\",\n        \"@com_google_absl//absl/time\",\n    ],\n)\n\ncc_library(\n    name = \"name_utils\",\n    srcs = [\"name_utils.cc\"],\n    hdrs = [\"name_utils.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    visibility = [\"//visibility:public\"],\n    deps = [\n        \"//tensorflow/core:lib\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ntf_cc_test(\n    name = \"name_utils_test\",\n    size = \"small\",\n    srcs = [\"name_utils_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":name_utils\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n    ],\n)\n\ncc_library(\n    name = \"rewrite_utils\",\n    srcs = [\"rewrite_utils.cc\"],\n    hdrs = [\"rewrite_utils.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":dataset_utils\",\n        \":hash_utils\",\n        \":serialization_utils\",\n        \"//tensorflow/core:core_cpu_internal\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:lib_internal\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/grappler:graph_view\",\n        \"//tensorflow/core/grappler:grappler_item\",\n        \"//tensorflow/core/grappler:grappler_item_builder\",\n        \"//tensorflow/core/grappler/clusters:virtual_cluster\",\n        \"//tensorflow/core/grappler/optimizers:custom_graph_optimizer_registry\",\n        \"//tensorflow/core/grappler/optimizers:meta_optimizer\",\n        \"//tensorflow/core/grappler/optimizers/data\",\n        \"//tensorflow/core/grappler/optimizers/data:function_utils\",\n        \"//tensorflow/core/grappler/optimizers/data:graph_utils\",\n        \"//tensorflow/core/platform\",\n        \"@com_google_absl//absl/container:flat_hash_set\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ntf_cc_test(\n    name = \"rewrite_utils_test\",\n    size = \"small\",\n    srcs = [\"rewrite_utils_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":rewrite_utils\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/framework:function_proto_cc\",\n        \"//tensorflow/core/framework:function_testlib\",\n        \"//tensorflow/core/framework:graph_proto_cc\",\n        \"//tensorflow/core/framework:tensor_testutil\",\n        \"//tensorflow/core/framework:types_proto_cc\",\n        \"//tensorflow/core/grappler:grappler_item\",\n        \"//tensorflow/core/ops\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ncc_library(\n    name = \"root_dataset\",\n    srcs = [\"root_dataset.cc\"],\n    hdrs = [\"root_dataset.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":dataset_utils\",\n        \":name_utils\",\n        \":rewrite_utils\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:framework_internal\",\n        \"//tensorflow/core:lib_internal\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/platform:errors\",\n        \"//tensorflow/core/platform:stringprintf\",\n    ],\n)\n\ncc_library(\n    name = \"serialization_utils\",\n    srcs = [\"serialization_utils.cc\"],\n    hdrs = [\"serialization_utils.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":compression_utils\",\n        \":dataset_utils\",\n        \"//tensorflow/core:core_cpu_base\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:graph\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/lib/core:status\",\n    ],\n)\n\ntf_cc_test(\n    name = \"serialization_utils_test\",\n    size = \"small\",\n    srcs = [\"serialization_utils_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":dataset_test_base\",\n        \":dataset_utils\",\n        \":serialization_utils\",\n        \"//tensorflow/cc:cc_ops\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:session_options\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/common_runtime:device_factory\",\n        \"//tensorflow/core/framework:tensor_testutil\",\n        \"//tensorflow/core/platform:errors\",\n        \"//tensorflow/core/platform:str_util\",\n        \"//tensorflow/tsl/platform:statusor\",\n        \"@com_google_absl//absl/container:flat_hash_set\",\n    ],\n)\n\ncc_library(\n    name = \"split_utils\",\n    srcs = [\"split_utils.cc\"],\n    hdrs = [\"split_utils.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n    ],\n)\n\ntf_cc_test(\n    name = \"split_utils_test\",\n    size = \"small\",\n    srcs = [\"split_utils_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":dataset_test_base\",\n        \":serialization_utils\",\n        \":split_utils\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/data:dataset_utils\",\n        \"//tensorflow/core/framework:tensor_testutil\",\n    ],\n)\n\ncc_library(\n    name = \"snapshot_utils\",\n    srcs = [\"snapshot_utils.cc\"],\n    hdrs = [\"snapshot_utils.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \"//tensorflow/core:core_cpu_lib\",\n        \"//tensorflow/core:dataset_ops_op_lib\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:lib_internal\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/data:name_utils\",\n        \"//tensorflow/core/platform:coding\",\n        \"//tensorflow/core/platform:random\",\n        \"//tensorflow/core/profiler/lib:traceme\",\n        \"@com_google_absl//absl/memory\",\n    ],\n)\n\ntf_cc_test(\n    name = \"snapshot_utils_test\",\n    size = \"small\",\n    srcs = [\"snapshot_utils_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":snapshot_utils\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/data/service:test_util\",\n    ],\n)\n\ncc_library(\n    name = \"standalone\",\n    srcs = [\"standalone.cc\"],\n    hdrs = [\"standalone.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":root_dataset\",\n        \":unbounded_thread_pool\",\n        \"//tensorflow/core:all_kernels\",\n        \"//tensorflow/core:core_cpu_internal\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:session_options\",\n        \"//tensorflow/core/data:serialization_utils\",\n        \"//tensorflow/core/framework:graph_proto_cc\",\n        \"//tensorflow/tsl/platform:env\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:refcount\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:statusor\",\n        \"@com_google_absl//absl/memory\",\n    ],\n)\n\ntf_cc_test(\n    name = \"standalone_save_restore_test\",\n    srcs = [\"standalone_save_restore_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":standalone\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core/data/service:common_proto_cc\",\n        \"//tensorflow/core/data/service:test_util\",\n        \"//tensorflow/tsl/platform:errors\",\n        \"//tensorflow/tsl/platform:status\",\n        \"//tensorflow/tsl/platform:status_matchers\",\n        \"//tensorflow/tsl/platform:statusor\",\n        \"//tensorflow/tsl/protobuf:protos_all_cc\",\n    ] + tf_protos_all(),\n)\n\ntf_cc_test(\n    name = \"standalone_test\",\n    srcs = [\"standalone_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":standalone\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n    ] + tf_protos_all(),\n)\n\ncc_library(\n    name = \"stats_utils\",\n    srcs = [\"stats_utils.cc\"],\n    hdrs = [\"stats_utils.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \"//tensorflow/core:lib\",\n        \"@com_google_absl//absl/base:core_headers\",\n    ],\n)\n\ncc_library(\n    name = \"unbounded_thread_pool\",\n    srcs = [\"unbounded_thread_pool.cc\"],\n    hdrs = [\"unbounded_thread_pool.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \"//tensorflow/core:core_cpu_internal\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:lib_internal\",\n        \"@com_google_absl//absl/memory\",\n    ],\n)\n\ncc_library(\n    name = \"finalization_utils\",\n    srcs = [\"finalization_utils.cc\"],\n    hdrs = [\"finalization_utils.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":root_dataset\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core/platform:errors\",\n        \"//tensorflow/core/platform:refcount\",\n    ],\n)\n\ntf_cc_test(\n    name = \"unbounded_thread_pool_test\",\n    size = \"small\",\n    srcs = [\"unbounded_thread_pool_test.cc\"],\n    # copybara:uncomment extra_copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \":unbounded_thread_pool\",\n        \"//tensorflow/core:lib_internal\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n    ],\n)\n\ncc_library(\n    name = \"utils\",\n    srcs = [\"utils.cc\"],\n    hdrs = [\"utils.h\"],\n    # copybara:uncomment copts = [\"-Wthread-safety-analysis\"],\n    deps = [\n        \"//tensorflow/core:framework\",\n    ],\n)"