"diff --git a/tensorflow/core/kernels/avgpooling_op.cc b/tensorflow/core/kernels/avgpooling_op.cc\nindex bc536d18751..4ee4b8ff324 100644\n--- a/tensorflow/core/kernels/avgpooling_op.cc\n+++ b/tensorflow/core/kernels/avgpooling_op.cc\n@@ -342,6 +342,19 @@ class AvgPoolingGradOp : public OpKernel {\n     const T* out_backprop_ptr = out_backprop.flat<T>().data();\n     T* input_backprop_ptr = output->flat<T>().data();\n \n+    for (int64_t r = 0; r < out_backprop_rows; ++r) {\n+      int rindex, rsize;\n+      OP_REQUIRES_OK(context,\n+                     GetBroadcastSize(r, in_rows, window_rows, row_stride,\n+                                      pad_rows, &rindex, &rsize));\n+      for (int64_t c = 0; c < out_backprop_cols; ++c) {\n+        int cindex, csize;\n+        OP_REQUIRES_OK(context,\n+                       GetBroadcastSize(c, in_cols, window_cols, col_stride,\n+                                        pad_cols, &cindex, &csize));\n+      }\n+    }\n+\n     auto shard = [context, out_backprop_ptr, input_backprop_ptr,\n                   out_backprop_rows, out_backprop_cols, out_backprop_depth,\n                   in_rows, in_cols, window_rows, window_cols, row_stride,"