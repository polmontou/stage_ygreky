"load(\"//tensorflow/core/platform:rules_cc.bzl\", \"cc_library\")\nload(\"//tensorflow/compiler/mlir:glob_lit_test.bzl\", \"glob_lit_tests\")\nload(\"//tensorflow:tensorflow.bzl\", \"tf_cc_binary\")\n\npackage(\n    # copybara:uncomment default_applicable_licenses = [\"//tensorflow:license\"],\n    default_visibility = [\n        \":__subpackages__\",\n        \"//tensorflow/compiler/mlir:__subpackages__\",\n        \"//tensorflow/core:__subpackages__\",\n        \"//tensorflow/tools/tfg_graph_transforms:__subpackages__\",\n    ],\n    licenses = [\"notice\"],  # Apache 2.0\n)\n\ncc_library(\n    name = \"parse_text_proto\",\n    srcs = [\n        \"parse_text_proto.cc\",\n    ],\n    hdrs = [\"parse_text_proto.h\"],\n    deps = [\n        \"//tensorflow/core:framework_lite\",\n        \"//tensorflow/core:lib_proto_parsing\",\n        \"//tensorflow/core/platform:casts\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ncc_library(\n    name = \"mangling\",\n    srcs = [\n        \"mangling.cc\",\n    ],\n    hdrs = [\"mangling.h\"],\n    deps = [\n        \":parse_text_proto\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:framework_lite\",\n        \"//tensorflow/core:lib_proto_parsing\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ncc_library(\n    name = \"load_proto\",\n    srcs = [\n        \"load_proto.cc\",\n    ],\n    hdrs = [\"load_proto.h\"],\n    deps = [\n        \":parse_text_proto\",\n        \"//tensorflow/core:framework_lite\",\n        \"//tensorflow/core:lib_proto_parsing\",\n        \"@com_google_absl//absl/strings\",\n        \"@llvm-project//llvm:Support\",\n    ],\n)\n\ncc_library(\n    name = \"convert_types\",\n    srcs = [\n        \"convert_types.cc\",\n    ],\n    hdrs = [\"convert_types.h\"],\n    deps = [\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib_proto_parsing\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/ir:Dialect\",\n        \"//tensorflow/core/ir/types:Dialect\",\n        \"//tensorflow/core/platform:statusor\",\n        \"@com_google_absl//absl/strings\",\n        \"@llvm-project//llvm:Support\",\n        \"@llvm-project//mlir:IR\",\n        \"@llvm-project//mlir:Support\",\n    ],\n)\n\ncc_library(\n    name = \"convert_tensor\",\n    srcs = [\n        \"convert_tensor.cc\",\n    ],\n    hdrs = [\"convert_tensor.h\"],\n    deps = [\n        \":convert_types\",\n        \":mangling\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:framework_lite\",\n        \"//tensorflow/core:lib_proto_parsing\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:tflite_portable_logging\",\n        \"//tensorflow/core/ir:Dialect\",\n        \"//tensorflow/core/ir/types:Dialect\",\n        \"//tensorflow/core/platform:errors\",\n        \"//tensorflow/core/platform:statusor\",\n        \"//tensorflow/tsl/platform:float8\",\n        \"@llvm-project//llvm:Support\",\n        \"@llvm-project//mlir:IR\",\n    ],\n)\n\ncc_library(\n    name = \"savedmodel_import\",\n    srcs = [\"savedmodel_import.cc\"],\n    hdrs = [\"savedmodel_import.h\"],\n    deps = [\n        \":graphdef_import\",\n        \"//tensorflow/core:core_cpu_base\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/platform:errors\",\n        \"//tensorflow/core/platform:statusor\",\n        \"@llvm-project//mlir:IR\",\n    ],\n)\n\ncc_library(\n    name = \"savedmodel_export\",\n    srcs = [\"savedmodel_export.cc\"],\n    hdrs = [\"savedmodel_export.h\"],\n    deps = [\n        \":graphdef_export\",\n        \"//tensorflow/core:core_cpu_base\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/platform:errors\",\n        \"//tensorflow/core/platform:status\",\n        \"@llvm-project//mlir:IR\",\n    ],\n)\n\ncc_library(\n    name = \"graphdef_import\",\n    srcs = [\n        \"functiondef_import.cc\",\n        \"graphdef_import.cc\",\n    ],\n    hdrs = [\n        \"functiondef_import.h\",\n        \"graphdef_import.h\",\n    ],\n    deps = [\n        \":convert_attributes\",\n        \":convert_types\",\n        \"//tensorflow/core:core_cpu_base\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/ir:Dialect\",\n        \"//tensorflow/core/ir/types:Dialect\",\n        \"//tensorflow/core/platform:errors\",\n        \"//tensorflow/core/platform:status\",\n        \"//tensorflow/core/platform:statusor\",\n        \"//tensorflow/core/platform:stringpiece\",\n        \"@com_google_absl//absl/container:flat_hash_map\",\n        \"@llvm-project//llvm:Support\",\n        \"@llvm-project//mlir:IR\",\n        \"@llvm-project//mlir:Support\",\n    ],\n)\n\ncc_library(\n    name = \"graphdef_export\",\n    srcs = [\n        \"functiondef_export.cc\",\n        \"graphdef_export.cc\",\n    ],\n    hdrs = [\n        \"functiondef_export.h\",\n        \"graphdef_export.h\",\n    ],\n    deps = [\n        \":convert_attributes\",\n        \":convert_types\",\n        \"//tensorflow/core:core_cpu_base\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/ir:Dialect\",\n        \"//tensorflow/core/ir/types:Dialect\",\n        \"//tensorflow/core/platform:errors\",\n        \"//tensorflow/core/platform:status\",\n        \"//tensorflow/core/platform:statusor\",\n        \"@com_google_absl//absl/strings\",\n        \"@llvm-project//llvm:Support\",\n        \"@llvm-project//mlir:IR\",\n        \"@llvm-project//mlir:Support\",\n    ],\n)\n\ncc_library(\n    name = \"convert_attributes\",\n    srcs = [\n        \"convert_attributes.cc\",\n    ],\n    hdrs = [\"convert_attributes.h\"],\n    deps = [\n        \":convert_tensor\",\n        \":convert_types\",\n        \":mangling\",\n        \"//tensorflow/compiler/xla:status_macros\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core/ir:Dialect\",\n        \"//tensorflow/core/ir/types:Dialect\",\n        \"//tensorflow/core/platform:errors\",\n        \"//tensorflow/core/platform:statusor\",\n        \"@com_google_absl//absl/strings\",\n        \"@llvm-project//llvm:Support\",\n        \"@llvm-project//mlir:IR\",\n        \"@llvm-project//mlir:Support\",\n    ],\n)\n\n# Command line tool to convert to/from GraphDef to MLIR Graph.\ntf_cc_binary(\n    name = \"tfg-translate\",\n    srcs = [\"tfg-translate.cc\"],\n    deps = [\n        \":graphdef_export\",\n        \":graphdef_import\",\n        \":load_proto\",\n        \"//tensorflow/core:ops\",  # Ops need to be registered for import.\n        \"//tensorflow/core/ir:Dialect\",\n        \"@llvm-project//mlir:IR\",\n        \"@llvm-project//mlir:Support\",\n        \"@llvm-project//mlir:TranslateLib\",\n    ],\n)\n\nglob_lit_tests(\n    data = [\"//tensorflow/core/ir:test_utilities\"],\n    driver = \"//tensorflow/core/ir:run_lit.sh\",\n    exclude = [],\n    test_file_exts = [\"mlir\"],\n)"