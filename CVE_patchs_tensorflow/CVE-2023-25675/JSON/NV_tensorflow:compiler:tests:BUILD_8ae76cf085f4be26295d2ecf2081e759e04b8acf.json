"load(\"//tensorflow/core/platform:rules_cc.bzl\", \"cc_library\")\nload(\"//tensorflow:tensorflow.default.bzl\", \"cuda_py_test\", \"tf_cuda_cc_test\")\nload(\"//tensorflow/compiler/aot:tfcompile.bzl\", \"tf_library\")\nload(\n    \"//tensorflow/compiler/tests:build_defs.bzl\",\n    \"generate_backend_suites\",\n    \"tf_xla_py_test\",\n)\nload(\n    \"//tensorflow/core/platform:build_config_root.bzl\",\n    \"tf_cuda_tests_tags\",\n)\nload(\"//tensorflow/python/tpu:tpu.bzl\", \"tpu_py_test\")\n\npackage(\n    # copybara:uncomment default_applicable_licenses = [\"//tensorflow:license\"],\n    default_visibility = [\":internal\"],\n    licenses = [\"notice\"],\n)\n\npackage_group(\n    name = \"internal\",\n    includes = [\n        \"//tensorflow/compiler/tf2xla:internal\",\n    ],\n)\n\npackage_group(\n    name = \"friends\",\n    includes = [\n        \"//tensorflow/compiler/tf2xla:friends\",\n    ],\n    packages = [\n        # To pass open source testing in the pip Kokoros.\n        \"//platforms/xla/tests/neural_nets\",\n    ],\n)\n\ngenerate_backend_suites()\n\npy_library(\n    name = \"xla_test\",\n    testonly = 1,\n    srcs = [\"xla_test.py\"],\n    srcs_version = \"PY3\",\n    visibility = [\":friends\"],\n    deps = [\n        \"//tensorflow/core:protos_all_py\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:client\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform\",\n        \"//tensorflow/python:random_seed\",\n        \"//tensorflow/python:session\",\n        \"//tensorflow/python:variables\",\n        \"//tensorflow/python/compiler/xla:compiler_py\",\n        \"//third_party/py/numpy\",\n    ],\n)\n\npy_library(\n    name = \"test_utils\",\n    testonly = 1,\n    srcs = [\n        \"__init__.py\",\n        \"test_utils.py\",\n    ],\n    srcs_version = \"PY3\",\n    deps = [\n        \"//third_party/py/numpy\",\n        \"@six_archive//:six\",\n    ],\n)\n\npy_test(\n    name = \"xla_test_test\",\n    size = \"small\",\n    srcs = [\"xla_test_test.py\"],\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"adadelta_test\",\n    size = \"medium\",\n    srcs = [\"adadelta_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"adagrad_test\",\n    size = \"small\",\n    srcs = [\"adagrad_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"adagrad_da_test\",\n    size = \"small\",\n    srcs = [\"adagrad_da_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_cuda_asan\",  # times out\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"adam_test\",\n    size = \"small\",\n    srcs = [\"adam_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_cuda_asan\",  # times out\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"add_n_test\",\n    size = \"small\",\n    srcs = [\"add_n_test.py\"],\n    # TensorList ops are not implemented in the on-demand compilation model yet.\n    disabled_backends = [\"cpu_ondemand\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:list_ops\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"argminmax_test\",\n    size = \"small\",\n    srcs = [\"argminmax_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_cuda_asan\",  # times out\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"binary_ops_test\",\n    size = \"medium\",\n    srcs = [\"binary_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 5,\n    tags = [\n        \"no_oss\",  # TODO(b/148108508): Re-enable this test in OSS.\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",  # Times out frequently in fastbuild mode.\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:bitwise_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:math_ops_gen\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"complex_div_test\",\n    size = \"medium\",\n    srcs = [\"complex_div_test.py\"],\n    enable_mlir_bridge = True,\n    enabled_backends = [\n        \"cpu\",\n        \"gpu\",\n    ],\n    python_version = \"PY3\",\n    shard_count = 2,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",  # Times out frequently in fastbuild mode.\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:math_ops_gen\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"bucketize_op_test\",\n    size = \"small\",\n    srcs = [\"bucketize_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"categorical_op_test\",\n    size = \"small\",\n    srcs = [\"categorical_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:random_ops\",\n        \"//tensorflow/python:standard_ops\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"cholesky_op_test\",\n    size = \"medium\",\n    srcs = [\"cholesky_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"no_rocm\",\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:map_fn\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"cond_test\",\n    size = \"small\",\n    srcs = [\"cond_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:control_flow_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:tensor_array_ops\",\n        \"//tensorflow/python:training\",\n        \"//tensorflow/python/eager:function\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"self_adjoint_eig_op_test\",\n    size = \"medium\",\n    srcs = [\"self_adjoint_eig_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:map_fn\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"searchsorted_op_test\",\n    size = \"small\",\n    timeout = \"moderate\",\n    srcs = [\"searchsorted_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"svd_op_test\",\n    size = \"medium\",\n    srcs = [\"svd_op_test.py\"],\n    disabled_backends = [\n        # TODO(b/129396575): Fails on CPU.\n        \"cpu\",\n        \"cpu_ondemand\",\n    ],\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"no_rocm\",\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:map_fn\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"matrix_inverse_op_test\",\n    size = \"small\",\n    timeout = \"moderate\",\n    srcs = [\"matrix_inverse_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"noasan\",\n        \"nomsan\",\n        \"notsan\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:linalg_ops\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"matrix_solve_op_test\",\n    size = \"small\",\n    timeout = \"moderate\",\n    srcs = [\"matrix_solve_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:linalg_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:random_ops\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"matrix_triangular_solve_op_test\",\n    size = \"small\",\n    timeout = \"moderate\",\n    srcs = [\"matrix_triangular_solve_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"clustering_test\",\n    size = \"small\",\n    srcs = [\"clustering_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"concat_ops_test\",\n    size = \"medium\",\n    srcs = [\"concat_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"noasan\",\n        \"nomsan\",\n        \"notsan\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:array_ops_gen\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:gradient_checker\",\n        \"//tensorflow/python:gradients\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"conv2d_test\",\n    size = \"medium\",\n    srcs = [\"conv2d_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 10,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":test_utils\",\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:nn\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"conv3d_test\",\n    size = \"medium\",\n    srcs = [\"conv3d_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 5,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:nn\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"depthwise_conv_op_test\",\n    size = \"medium\",\n    srcs = [\"depthwise_conv_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 5,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"no_rocm\",\n        \"noasan\",\n        \"nomsan\",\n        \"notsan\",\n        \"optonly\",  # Times out frequently in fastbuild mode.\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:nn\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"dynamic_slice_ops_test\",\n    size = \"small\",\n    srcs = [\"dynamic_slice_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \"//tensorflow/compiler/tests:xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:dtypes\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"einsum_op_test\",\n    size = \"medium\",\n    srcs = [\"einsum_op_test.py\"],\n    enable_mlir_bridge = True,\n    enabled_backends = [\n        \"cpu\",\n        \"gpu\",\n    ],\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:special_math_ops\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"reshape_op_test\",\n    size = \"small\",\n    srcs = [\"reshape_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \"//tensorflow/compiler/tests:xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:dtypes\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"dynamic_stitch_test\",\n    size = \"small\",\n    srcs = [\"dynamic_stitch_test.py\"],\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:data_flow_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"extract_image_patches_op_test\",\n    size = \"small\",\n    srcs = [\"extract_image_patches_op_test.py\"],\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"eager_test\",\n    size = \"medium\",\n    srcs = [\"eager_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"multi_and_single_gpu\",\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:layers\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:nn\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python/eager:function\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"fifo_queue_test\",\n    size = \"medium\",\n    srcs = [\"fifo_queue_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:data_flow_ops\",\n        \"//tensorflow/python:extra_py_tests_deps\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"fft_test\",\n    size = \"medium\",\n    srcs = [\"fft_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    shard_count = 12,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"no_rocm\",\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:extra_py_tests_deps\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python/ops/signal\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"slice_ops_test\",\n    size = \"medium\",\n    srcs = [\"slice_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_cuda_asan\",  # times out\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:data_flow_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"ftrl_test\",\n    size = \"medium\",\n    srcs = [\"ftrl_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"ftrl_ops_test\",\n    size = \"medium\",\n    srcs = [\"ftrl_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n        \"//tensorflow/python:variables\",\n        \"//tensorflow/python/tpu\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"function_test\",\n    size = \"small\",\n    srcs = [\"function_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"image_ops_test\",\n    size = \"small\",\n    timeout = \"long\",\n    srcs = [\"image_ops_test.py\"],\n    enable_mlir_bridge = False,\n    enabled_backends = [\n        \"cpu\",\n        \"gpu\",\n    ],\n    python_version = \"PY3\",\n    shard_count = 10,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",  # Times out frequently in fastbuild mode.\n        \"requires-gpu-nvidia\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:image_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"listdiff_op_test\",\n    size = \"small\",\n    srcs = [\"listdiff_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_cuda_asan\",  # times out\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:data_flow_ops\",\n        \"//tensorflow/python:framework_for_generated_wrappers\",\n        \"//tensorflow/python:framework_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"lrn_ops_test\",\n    size = \"medium\",\n    srcs = [\"lrn_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:nn\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"manip_ops_test\",\n    size = \"small\",\n    srcs = [\"manip_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:manip_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"matrix_band_part_test\",\n    size = \"medium\",\n    timeout = \"long\",\n    srcs = [\"matrix_band_part_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"matrix_diag_ops_test\",\n    size = \"medium\",\n    timeout = \"long\",\n    srcs = [\"matrix_diag_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 8,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:dtypes\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"momentum_test\",\n    size = \"small\",\n    srcs = [\"momentum_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"nary_ops_test\",\n    size = \"small\",\n    srcs = [\"nary_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"nullary_ops_test\",\n    size = \"small\",\n    srcs = [\"nullary_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:control_flow_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"pooling_ops_test\",\n    size = \"medium\",\n    srcs = [\"pooling_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 20,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"pooling_ops_3d_test\",\n    size = \"medium\",\n    srcs = [\"pooling_ops_3d_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 20,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"proximal_adagrad_test\",\n    size = \"medium\",\n    srcs = [\"proximal_adagrad_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"proximal_gradient_descent_test\",\n    size = \"medium\",\n    srcs = [\"proximal_gradient_descent_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"qr_op_test\",\n    size = \"medium\",\n    srcs = [\"qr_op_test.py\"],\n    disabled_backends = [\n        # Test is very slow on CPU.\n        \"cpu\",\n        \"cpu_ondemand\",\n    ],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 5,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework_for_generated_wrappers\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"unstack_test\",\n    size = \"medium\",\n    srcs = [\"unstack_test.py\"],\n    disabled_backends = [\n        # TODO(b/149750262): timeout on CPU.\n        \"cpu\",\n        \"cpu_ondemand\",\n    ],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 5,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework_for_generated_wrappers\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"random_ops_test\",\n    size = \"medium\",\n    srcs = [\"random_ops_test.py\"],\n    python_version = \"PY3\",\n    shard_count = 10,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow:tensorflow_py\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:random_ops\",\n        \"//tensorflow/python:standard_ops\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"reduce_ops_test\",\n    size = \"medium\",\n    srcs = [\"reduce_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 5,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:errors\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"reduce_window_test\",\n    size = \"small\",\n    srcs = [\"reduce_window_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:errors\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"reverse_ops_test\",\n    size = \"medium\",\n    srcs = [\"reverse_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"reverse_sequence_op_test\",\n    size = \"medium\",\n    srcs = [\"reverse_sequence_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\n# copybara:uncomment_begin(google-only)\n# tf_xla_py_test(\n#     name = \"reverse_sequence_op_args_test\",\n#     size = \"medium\",\n#     srcs = [\"reverse_sequence_op_args_test.py\"],\n#     enable_mlir_bridge = False,\n#     main = \"reverse_sequence_op_args_test.py\",\n#     python_version = \"PY3\",\n#     tags = [\n#         \"no_pip\",\n#         \"optonly\",\n#     ],\n#     deps = [\n#         \":xla_test\",\n#         \"//tensorflow/compiler/jit:xla_cpu_jit\",  # DisableOnExport\n#         \"//tensorflow/python:array_ops\",\n#         \"//tensorflow/python:framework\",\n#         \"//tensorflow/python:platform_test\",\n#         \"//tensorflow/python/compat:v2_compat\",\n#         \"//tensorflow/python/eager:function\",\n#     ],\n# )\n# copybara:uncomment_end\n\ntf_xla_py_test(\n    name = \"rmsprop_test\",\n    size = \"small\",\n    srcs = [\"rmsprop_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"scan_ops_test\",\n    size = \"medium\",\n    srcs = [\"scan_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 6,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"segment_reduction_ops_test\",\n    size = \"medium\",\n    srcs = [\"segment_reduction_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"noasan\",\n        \"nomsan\",\n        \"notsan\",\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:math_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"spacetobatch_op_test\",\n    size = \"medium\",\n    srcs = [\"spacetobatch_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 3,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"sparse_to_dense_op_test\",\n    size = \"small\",\n    srcs = [\"sparse_to_dense_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:sparse_ops\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"stack_ops_test\",\n    size = \"small\",\n    srcs = [\"stack_ops_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"config-cuda-only\",\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    use_xla_device = False,\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:data_flow_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"stateful_random_ops_test\",\n    size = \"medium\",\n    srcs = [\"stateful_random_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 10,\n    tags = [\n        \"no_oss\",  # b/170479349\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"notap\",  # b/170479349\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:standard_ops\",\n        \"//tensorflow/python:stateful_random_ops\",\n        \"//tensorflow/python/kernel_tests/random:util\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"stateless_random_ops_test\",\n    size = \"medium\",\n    srcs = [\"stateless_random_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 10,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:standard_ops\",\n        \"//tensorflow/python:stateless_random_ops\",\n        \"//tensorflow/python/kernel_tests/random:util\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"tensor_array_ops_test\",\n    size = \"medium\",\n    srcs = [\"tensor_array_ops_test.py\"],\n    # TensorArray ops are not implemented in the on-demand compilation model yet.\n    disabled_backends = [\"cpu_ondemand\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"config-cuda-only\",\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"v1only\",\n    ],\n    use_xla_device = False,\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:math_ops_gen\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:tensor_array_grad\",\n        \"//tensorflow/python:tensor_array_ops\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"tensor_list_ops_test\",\n    size = \"small\",\n    srcs = [\"tensor_list_ops_test.py\"],\n    # TensorList ops are not implemented in the on-demand compilation model yet.\n    disabled_backends = [\"cpu_ondemand\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:list_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python/eager:function\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"ternary_ops_test\",\n    size = \"medium\",\n    srcs = [\"ternary_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 4,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"noasan\",\n        \"notsan\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:extra_py_tests_deps\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"unary_ops_test\",\n    size = \"medium\",\n    srcs = [\"unary_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 4,\n    tags = [\n        \"no_cuda_asan\",  # times out\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"fused_batchnorm_test\",\n    size = \"medium\",\n    srcs = [\"fused_batchnorm_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 5,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":test_utils\",\n        \":xla_test\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:math_ops_gen\",\n        \"//tensorflow/python:nn\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"variable_ops_test\",\n    size = \"small\",\n    srcs = [\"variable_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:math_ops_gen\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"while_test\",\n    size = \"small\",\n    srcs = [\"while_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"case_test\",\n    size = \"small\",\n    srcs = [\"case_test.py\"],\n    disabled_backends = [\"cpu_ondemand\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    use_xla_device = False,  # Uses tf.function(jit_compile=True)\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:image_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"cast_ops_test\",\n    size = \"small\",\n    srcs = [\"cast_ops_test.py\"],\n    disabled_backends = [\"cpu_ondemand\"],\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    use_xla_device = False,  # Uses tf.function(jit_compile=True)\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:image_ops\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"gather_test\",\n    size = \"medium\",\n    srcs = [\"gather_test.py\"],\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:data_flow_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"gather_nd_op_test\",\n    size = \"medium\",\n    srcs = [\"gather_nd_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"scatter_nd_op_test\",\n    size = \"medium\",\n    srcs = [\"scatter_nd_op_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"sort_ops_test\",\n    size = \"medium\",\n    srcs = [\"sort_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 50,\n    # Times out in fastbuild mode.\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \"//tensorflow/compiler/tests:xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:dtypes\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"data_format_ops_test\",\n    size = \"small\",\n    srcs = [\"data_format_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \"//tensorflow/compiler/tests:xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:dtypes\",\n        \"//tensorflow/python:nn_ops\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"xla_device_test\",\n    size = \"small\",\n    srcs = [\"xla_device_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ncuda_py_test(\n    name = \"xla_device_gpu_test\",\n    size = \"small\",\n    srcs = [\"xla_device_gpu_test.py\"],\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    xla_enable_strict_auto_jit = False,\n    xla_enabled = True,\n    deps = [\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:client\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:control_flow_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n    ],\n)\n\ncuda_py_test(\n    name = \"jit_test\",\n    size = \"medium\",\n    srcs = [\"jit_test.py\"],\n    #shard_count = 5,\n    tags = [\n        \"no_cuda_asan\",  # Times out.\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    xla_enable_strict_auto_jit = False,\n    xla_enabled = True,\n    deps = [\n        \":test_utils\",\n        \"//tensorflow/core:protos_all_py\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:client\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:control_flow_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:gradients\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python/compiler/xla:compiler_py\",\n    ],\n)\n\ncuda_py_test(\n    name = \"async_comp_test\",\n    size = \"medium\",\n    srcs = [\"async_comp_test.py\"],\n    shard_count = 5,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    xla_enable_strict_auto_jit = False,\n    xla_enabled = True,\n    deps = [\n        \":test_utils\",\n        \"//tensorflow/core:protos_all_py\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:client\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python/compiler/xla:compiler_py\",\n    ],\n)\n\ncuda_py_test(\n    name = \"dense_layer_test\",\n    size = \"medium\",\n    srcs = [\"dense_layer_test.py\"],\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    xla_enable_strict_auto_jit = False,\n    xla_enabled = True,\n    deps = [\n        \":test_utils\",\n        \"//tensorflow/core:protos_all_py\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:layers\",\n        \"//tensorflow/python:variables\",\n        \"//tensorflow/python/compiler/xla:compiler_py\",\n    ],\n)\n\ncc_library(\n    name = \"randomized_tests_library\",\n    testonly = 1,\n    srcs = [\"randomized_tests.cc\"],\n    deps = [\n        \"//tensorflow/compiler/jit\",\n        \"//tensorflow/compiler/jit:common\",\n        \"//tensorflow/compiler/jit:flags_headers\",\n        \"//tensorflow/compiler/tf2xla:common\",\n        \"//tensorflow/core:core_cpu\",\n        \"//tensorflow/core:core_cpu_internal\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:framework_internal\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:tensorflow_opensource\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:testlib\",\n        \"@com_google_absl//absl/algorithm:container\",\n        \"@com_google_absl//absl/container:flat_hash_set\",\n        \"@com_google_absl//absl/strings\",\n    ],\n)\n\ntf_cuda_cc_test(\n    name = \"randomized_tests\",\n    size = \"medium\",\n    args = [\"--tf_xla_test_use_mlir=false\"],\n    shard_count = 20,\n    # This test is randomized, so only run it if explicitly requested.\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"manual\",\n        \"notap\",\n    ] + tf_cuda_tests_tags(),\n    deps = [\":randomized_tests_library\"],\n)\n\ntf_cuda_cc_test(\n    name = \"randomized_tests_mlir\",\n    size = \"medium\",\n    args = [\"--tf_xla_test_use_mlir=true\"],\n    shard_count = 20,\n    # This test is randomized, so only run it if explicitly requested.\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"manual\",\n        \"notap\",\n    ] + tf_cuda_tests_tags(),\n    deps = [\":randomized_tests_library\"],\n)\n\n# Create a deterministic version of randomized_tests_mlir with fixed seed.\n# This can be used in presubmit checks as it is no longer randomized.\ntf_cuda_cc_test(\n    name = \"randomized_tests_mlir_seeded\",\n    size = \"medium\",\n    args = [\n        \"--tf_xla_random_seed=200839030\",\n        \"--tf_xla_test_use_mlir=true\",\n        \"--tf_xla_test_device=GPU:0\",\n    ],\n    shard_count = 20,\n    tags = [\n        \"config-cuda-only\",\n        \"no_cuda_asan\",  # TODO(b/201651800)\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"requires-gpu-nvidia\",\n        \"no_rocm\",  # ROCmSoftwarePlatform #958\n    ] + tf_cuda_tests_tags(),\n    deps = [\":randomized_tests_library\"],\n)\n\n# Create a deterministic version of randomized_tests with fixed seed.\n# This can be used in presubmit checks as it is no longer randomized.\ntf_cuda_cc_test(\n    name = \"randomized_tests_seeded\",\n    size = \"medium\",\n    args = [\n        \"--tf_xla_random_seed=200839030\",\n        \"--tf_xla_test_use_mlir=false\",\n        \"--tf_xla_test_device=GPU:0\",\n    ],\n    shard_count = 20,\n    tags = [\n        \"config-cuda-only\",\n        \"no_cuda_asan\",  # TODO(b/201651800)\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"requires-gpu-nvidia\",\n        \"no_rocm\",  # ROCmSoftwarePlatform #958\n    ] + tf_cuda_tests_tags(),\n    deps = [\":randomized_tests_library\"],\n)\n\ntf_cuda_cc_test(\n    name = \"unary_ops_composition_test\",\n    srcs = [\"unary_ops_composition_test.cc\"],\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ] + tf_cuda_tests_tags(),\n    deps = [\n        \"//tensorflow/cc:cc_ops\",\n        \"//tensorflow/compiler/jit\",\n        \"//tensorflow/compiler/jit:flags\",\n        \"//tensorflow/compiler/jit:xla_kernel_creator\",\n        \"//tensorflow/compiler/tf2xla:xla_compiler\",\n        \"//tensorflow/core:core_cpu\",\n        \"//tensorflow/core:framework\",\n        \"//tensorflow/core:lib\",\n        \"//tensorflow/core:protos_all_cc\",\n        \"//tensorflow/core:test\",\n        \"//tensorflow/core:test_main\",\n        \"//tensorflow/core:testlib\",\n        \"//tensorflow/core/kernels:ops_testutil\",\n        \"@com_google_absl//absl/synchronization\",\n    ],\n)\n\npy_library(\n    name = \"lstm\",\n    testonly = 1,\n    srcs = [\"lstm.py\"],\n    srcs_version = \"PY3\",\n    deps = [\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:random_ops\",\n        \"//tensorflow/python:variables\",\n        \"@six_archive//:six\",\n    ],\n)\n\ncuda_py_test(\n    name = \"lstm_test\",\n    srcs = [\"lstm_test.py\"],\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    xla_enable_strict_auto_jit = False,\n    xla_enabled = True,\n    deps = [\n        \":lstm\",\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:gradients\",\n        \"//tensorflow/python:init_ops\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform\",\n        \"//tensorflow/python:variables\",\n    ],\n)\n\n# An example of ahead-of-time compilation using tfcompile.  The\n# lstm_layer_inference.pbtxt file was generated by running lstm_test\n# --dump_graph_dir, and the config file was written by hand.\n#\n# Run the following to build a minimal benchmark of the computation on Android:\n# $ bazel build -c opt --cxxopt='-std=c++11' --linkopt='-lm' \\\n#   --cpu=armeabi-v7a \\\n#   --host_crosstool_top=@bazel_tools//tools/cpp:toolchain \\\n#   --crosstool_top=//external:android/crosstool \\\n#   //tensorflow/compiler/tests:lstm_layer_inference_benchmark\n\n#\n# Currently the resulting binary size is ~190KB\ntf_library(\n    name = \"lstm_layer_inference\",\n    testonly = 1,\n    config = \"lstm_layer_inference.config.pbtxt\",\n    cpp_class = \"LSTMLayerInference\",\n    graph = \"lstm_layer_inference.pbtxt\",\n    tags = [\"manual\"],\n    tfcompile_flags = [\"--xla_cpu_multi_thread_eigen=false\"],\n)\n\ntf_xla_py_test(\n    name = \"fake_quant_ops_test\",\n    size = \"medium\",\n    srcs = [\"fake_quant_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"placeholder_test\",\n    size = \"small\",\n    srcs = [\"placeholder_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"quantized_ops_test\",\n    size = \"medium\",\n    srcs = [\"quantized_ops_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:bitwise_ops\",\n        \"//tensorflow/python:constant_op\",\n        \"//tensorflow/python:dtypes\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"xla_ops_test\",\n    size = \"medium\",\n    srcs = [\"xla_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:errors\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"xla_custom_call_ops_test\",\n    size = \"small\",\n    srcs = [\"xla_custom_call_ops_test.py\"],\n    disabled_backends = [\n        \"gpu\",\n    ],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"notap\",\n    ],\n    use_xla_device = False,  # Uses tf.function(jit_compile=True)\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"runtime_shape_check_test\",\n    size = \"small\",\n    srcs = [\"runtime_shape_check_test.py\"],\n    disabled_backends = [\n        \"cpu\",\n        \"cpu_ondemand\",\n    ],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",\n        \"notap\",\n    ],\n    use_xla_device = False,\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"conv_node_name_test\",\n    size = \"medium\",\n    srcs = [\"conv_node_name_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    shard_count = 5,\n    tags = [\n        \"no_oss\",  # TODO(b/148108508): Re-enable this test in OSS.\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:layers\",\n        \"//tensorflow/python:nn\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python:nn_ops_gen\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"tridiagonal_solve_ops_test\",\n    size = \"medium\",\n    srcs = [\"tridiagonal_solve_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:linalg_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:standard_ops\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"tridiagonal_matmul_ops_test\",\n    size = \"medium\",\n    srcs = [\"tridiagonal_matmul_ops_test.py\"],\n    enable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:linalg_ops\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:standard_ops\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"special_math_test\",\n    size = \"medium\",\n    srcs = [\"special_math_test.py\"],\n    enable_mlir_bridge = True,\n    shard_count = 5,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:extra_py_tests_deps\",\n        \"//tensorflow/python:math_ops\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"repeat_op_test\",\n    size = \"medium\",\n    srcs = [\"repeat_op_test.py\"],\n    enable_mlir_bridge = True,\n    shard_count = 5,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:extra_py_tests_deps\",\n        \"//tensorflow/python:math_ops\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"image_ops_jit_compile_test\",\n    size = \"medium\",\n    srcs = [\"image_ops_jit_compile_test.py\"],\n    disabled_backends = [\n        \"cpu_ondemand\",\n    ],\n    enable_mlir_bridge = False,\n    shard_count = 5,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    use_xla_device = False,\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:extra_py_tests_deps\",\n        \"//tensorflow/python:math_ops\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"ensure_shape_op_test\",\n    size = \"medium\",\n    srcs = [\"ensure_shape_op_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"where_op_test\",\n    size = \"small\",\n    srcs = [\"where_op_test.py\"],\n    enable_mlir_bridge = False,\n    enabled_backends = [\n        \"cpu\",\n        \"gpu\",\n    ],\n    tags = [\n        \"no_pip\",\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:control_flow_ops\",\n        \"//tensorflow/python:errors\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python/compiler/xla:compiler_py\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"where_op_tpu_test\",\n    size = \"small\",\n    srcs = [\"where_op_test.py\"],\n    args = [\"--tpu_use_tfrt=true\"],\n    disabled_backends = [\n        \"cpu\",\n        \"cpu_ondemand\",\n        \"gpu\",\n    ],\n    enable_mlir_bridge = False,\n    main = \"where_op_test.py\",\n    tags = [\n        \"no_pip\",\n        \"optonly\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:client_testlib\",\n        \"//tensorflow/python:control_flow_ops\",\n        \"//tensorflow/python:errors\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python/compiler/xla:compiler_py\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"risc_ops_test\",\n    size = \"small\",\n    srcs = [\"risc_ops_test.py\"],\n    enabled_backends = [\"cpu\"],\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:is_mlir_bridge_test_true\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python/eager:function\",\n        \"//tensorflow/python/ops/risc:risc_ops\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"const_arg_test\",\n    size = \"small\",\n    srcs = [\"const_arg_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:is_mlir_bridge_test_false\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)\n\ncuda_py_test(\n    name = \"const_test\",\n    size = \"small\",\n    srcs = [\"const_test.py\"],\n    python_version = \"PY3\",\n    xla_enable_strict_auto_jit = False,\n    xla_enabled = True,\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:constant_op\",\n        \"//tensorflow/python:framework\",\n    ],\n)\n\ntpu_py_test(\n    name = \"giant_const_op_test\",\n    srcs = [\n        \"giant_const_op_test.py\",\n    ],\n    disable_experimental = True,\n    # TODO(b/188995810): Add an optimization in MLIR importer to not\n    # materialize giant splat constants.\n    disable_mlir_bridge = True,\n    python_version = \"PY3\",\n    tags = [\"no_oss\"],\n    deps = [\n        \"//tensorflow/python/distribute/cluster_resolver:cluster_resolver_lib\",\n        \"//tensorflow/python/eager:remote\",\n        \"//tensorflow/python/eager:test\",\n        \"//tensorflow/python/tpu:tpu_lib\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"sharding_util_ops_test\",\n    srcs = [\"sharding_util_ops_test.py\"],\n    disabled_backends = [\n        \"cpu\",\n        \"cpu_ondemand\",\n        \"gpu\",\n    ],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    shard_count = 10,\n    tags = [\n        \"notap\",\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:constant_op\",\n        \"//tensorflow/python:framework_ops\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:resource_variable_ops\",\n        \"//tensorflow/python:session\",\n        \"//tensorflow/python:variables\",\n        \"//tensorflow/python/tpu:tpu_lib\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntpu_py_test(\n    name = \"approx_topk_test\",\n    srcs = [\"approx_topk_test.py\"],\n    disable_experimental = False,\n    disable_mlir_bridge = False,\n    tags = [\"no_oss\"],\n    deps = [\n        \"//tensorflow/python:array_ops\",\n        \"//tensorflow/python:math_ops\",\n        \"//tensorflow/python:nn_ops\",\n        \"//tensorflow/python/eager:backprop\",\n        \"//tensorflow/python/eager:def_function\",\n        \"//tensorflow/python/eager:test\",\n        \"//tensorflow/python/framework:dtypes\",\n        \"//tensorflow/python/framework:ops\",\n        \"//tensorflow/python/framework:test_lib\",\n        \"//third_party/py/numpy\",\n        \"@absl_py//absl/testing:parameterized\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"xla_call_module_test\",\n    size = \"small\",\n    srcs = [\"xla_call_module_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n        \"notap\",\n    ],\n    use_xla_device = False,  # Uses tf.function(jit_compile=True)\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/compiler/tf2xla/python:xla\",\n        \"//tensorflow/python:framework\",\n        \"//tensorflow/python:platform_test\",\n        \"//tensorflow/python:training\",\n    ],\n)\n\ntf_xla_py_test(\n    name = \"bincount_op_test\",\n    size = \"small\",\n    srcs = [\"bincount_op_test.py\"],\n    enable_mlir_bridge = False,\n    python_version = \"PY3\",\n    shard_count = 10,\n    tags = [\n        \"no_pip\",  # TODO(b/149738646): fix pip install so these tests run on kokoro pip\n    ],\n    deps = [\n        \":xla_test\",\n        \"//tensorflow/python:platform_test\",\n    ],\n)"